<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accurate Orbital Simulation with Orbit Lines</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
        #zoomBar, #angleBar {
            position: absolute;
            left: 10px;
            z-index: 1;
        }
        #zoomBar { top: 10px; width: 300px; }
        #angleBar { top: 50px; width: 300px; }
    </style>
</head>
<body>
    <!-- Zoom Bar -->
    <input type="range" id="zoomBar" min="1" max="100" value="60">
    <!-- Camera Angle Bar -->
    <input type="range" id="angleBar" min="0" max="90" value="45">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/jsm/utils/FontLoader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/jsm/geometries/TextGeometry.js"></script>
    <script>
        let scene, camera, renderer, sun, planets = [], dwarfPlanets = [];

        const planetData = [
            { name: 'Mercury', radius: 0.2, semiMajorAxis: 0.39, eccentricity: 0.205, period: 0.24, inclination: 7.0, axialTilt: 0.034, color: 0xaaaaaa },
            { name: 'Venus', radius: 0.3, semiMajorAxis: 0.72, eccentricity: 0.007, period: 0.615, inclination: 3.4, axialTilt: 177.4, color: 0xffcc00 },
            { name: 'Earth', radius: 0.35, semiMajorAxis: 1.00, eccentricity: 0.017, period: 1.00, inclination: 0.0, axialTilt: 23.5, color: 0x0000ff },
            { name: 'Mars', radius: 0.25, semiMajorAxis: 1.52, eccentricity: 0.093, period: 1.88, inclination: 25.2, axialTilt: 25.2, color: 0xff0000 },
            { name: 'Jupiter', radius: 0.5, semiMajorAxis: 5.20, eccentricity: 0.049, period: 11.86, inclination: 1.3, axialTilt: 3.1, color: 0xffcc99 },
            { name: 'Saturn', radius: 0.4, semiMajorAxis: 9.58, eccentricity: 0.056, period: 29.46, inclination: 2.5, axialTilt: 26.7, color: 0xffff00 },
            { name: 'Uranus', radius: 0.3, semiMajorAxis: 19.22, eccentricity: 0.046, period: 84.01, inclination: 0.8, axialTilt: 97.8, color: 0x00ffff },
            { name: 'Neptune', radius: 0.3, semiMajorAxis: 30.05, eccentricity: 0.010, period: 164.8, inclination: 1.8, axialTilt: 28.3, color: 0x0000cc },
        ];

        const dwarfPlanetData = [
            { name: 'Pluto', radius: 0.15, semiMajorAxis: 39.48, eccentricity: 0.249, period: 248, inclination: 17.2, axialTilt: 119.6, color: 0xcccccc },
            { name: 'Eris', radius: 0.15, semiMajorAxis: 96.3, eccentricity: 0.437, period: 557, inclination: 44.0, axialTilt: 8.3, color: 0x999999 },
            { name: 'Haumea', radius: 0.15, semiMajorAxis: 43.19, eccentricity: 0.199, period: 283, inclination: 28.2, axialTilt: 28.0, color: 0xffcc99 },
            { name: 'Makemake', radius: 0.15, semiMajorAxis: 45.79, eccentricity: 0.160, period: 305, inclination: 28.0, axialTilt: 28.2, color: 0xccffcc },
            { name: 'Ceres', radius: 0.15, semiMajorAxis: 2.77, eccentricity: 0.080, period: 4.60, inclination: 4.0, axialTilt: 3.4, color: 0xffff00 },
        ];

        function init() {
            // Create the scene
            scene = new THREE.Scene();

            // Create the camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 45, 60);

            // Create the renderer
            renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Create the sun
            const sunGeometry = new THREE.SphereGeometry(0.5, 32, 32);
            const sunMaterial = new THREE.MeshBasicMaterial({ color: 0xffff00 });
            sun = new THREE.Mesh(sunGeometry, sunMaterial);
            scene.add(sun);

            // Create planets and their orbits
            planetData.forEach(data => {
                createCelestialBody(data, planets);
                createOrbitLine(data, data.color);
            });

            // Create dwarf planets and their orbits
            dwarfPlanetData.forEach(data => {
                createCelestialBody(data, dwarfPlanets);
                createOrbitLine(data, data.color);
            });
        }

        function createCelestialBody(data, collection) {
            const geometry = new THREE.SphereGeometry(data.radius, 32, 32);
            const material = new THREE.MeshBasicMaterial({ color: data.color });
            const celestialBody = new THREE.Mesh(geometry, material);

            celestialBody.userData = { 
                semiMajorAxis: data.semiMajorAxis, 
                eccentricity: data.eccentricity,
                period: data.period, 
                speed: (2 * Math.PI) / (data.period * 60), // 60 frames per second
                angle: 0,
                inclination: THREE.MathUtils.degToRad(data.inclination), // Convert to radians
                axialTilt: THREE.MathUtils.degToRad(data.axialTilt) 
            };
            celestialBody.rotation.x = celestialBody.userData.axialTilt;

            collection.push(celestialBody);
            scene.add(celestialBody);

            createTextLabel(data.name, celestialBody);
        }

        function createTextLabel(text, celestialBody) {
            const loader = new THREE.FontLoader();
            loader.load('https://threejs.org/examples/fonts/helvetiker_regular.typeface.json', function (font) {
                const textGeometry = new THREE.TextGeometry(text, {
                    font: font,
                    size: 0.5,
                    height: 0.1,
                    curveSegments: 12,
                    bevelEnabled: false
                });

                const textMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff });
                const textMesh = new THREE.Mesh(textGeometry, textMaterial);

                textMesh.position.set(celestialBody.position.x, celestialBody.position.y + 1, celestialBody.position.z);
                scene.add(textMesh);
                celestialBody.userData.textMesh = textMesh;
            });
        }

        function createOrbitLine(data, color) {
            const { semiMajorAxis, eccentricity, inclination } = data;
            const semiMinorAxis = semiMajorAxis * Math.sqrt(1 - Math.pow(eccentricity, 2));

            const curve = new THREE.EllipseCurve(
                0,  0,            // Center
                semiMajorAxis,     // x radius
                semiMinorAxis,     // y radius
                0,  2 * Math.PI,   // Start and end angle
                false,             // Clockwise
                0                  // Rotation angle
            );

            const points = curve.getPoints(100);
            const orbitGeometry = new THREE.BufferGeometry().setFromPoints(points);
            orbitGeometry.rotateX(THREE.MathUtils.degToRad(90)); // Rotate to make flat

            // Tilt the orbit by the planet's inclination
            orbitGeometry.rotateZ(THREE.MathUtils.degToRad(inclination));

            const orbitMaterial = new THREE.LineBasicMaterial({ color });
            const orbitLine = new THREE.Line(orbitGeometry, orbitMaterial);

            scene.add(orbitLine);
        }

        function animate() {
            requestAnimationFrame(animate);

            planets.forEach(planet => updateCelestialBodyPosition(planet));
            dwarfPlanets.forEach(dwarfPlanet => updateCelestialBodyPosition(dwarfPlanet));

            updateTextLabels();
            renderer.render(scene, camera);
        }

        function updateCelestialBodyPosition(celestialBody) {
            const { semiMajorAxis, eccentricity, speed, angle, inclination } = celestialBody.userData;

            celestialBody.userData.angle += speed;
            const semiMinorAxis = semiMajorAxis * Math.sqrt(1 - Math.pow(eccentricity, 2));
            const x = semiMajorAxis * Math.cos(celestialBody.userData.angle);
            const z = semiMinorAxis * Math.sin(celestialBody.userData.angle);

            celestialBody.position.x = x;
            celestialBody.position.z = z * Math.cos(inclination);
            celestialBody.position.y = z * Math.sin(inclination);
        }

        function updateTextLabels() {
            planets.concat(dwarfPlanets).forEach(body => {
                if (body.userData.textMesh) {
                    body.userData.textMesh.position.set(body.position.x, body.position.y + 1, body.position.z);
                }
            });
        }

        document.getElementById('zoomBar').addEventListener('input', function () {
            const zoomLevel = this.value;
            camera.position.z = 60 - (zoomLevel / 100) * 40;
        });

        document.getElementById('angleBar').addEventListener('input', function () {
            const angle = this.value;
            camera.position.y = angle;
            camera.lookAt(0, 0, 0);
        });

        init();
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
